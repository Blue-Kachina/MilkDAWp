# Dependency Audit — Phase 0 Baseline (2025‑10‑12)

Scope: Establish the current baseline for dependencies, toolchain knobs, and build/linkage assumptions prior to transitioning to a dynamic linking model (see DEPENDENCY_ROADMAP.md and DEPENDENCY_REQUIREMENTS.md).

Summary
- Project type: JUCE-based VST3 plugin (MilkDAWp) with optional libprojectM integration (currently off by default).
- Dependency acquisition: FetchContent for JUCE and projectM (no submodules yet).
- Toolchain minimums: cmake_minimum_required is 3.20 (ROADMAP requires >= 3.22).
- Runtime linkage (Windows): Project currently prefers static MSVC runtime (/MT) via an option and flag rewrite; roadmap requires /MD.
- projectM: Optional; no enforced presence or dynamic/shared check yet.
- Packaging: No explicit copy/bundle of projectM since it is optional and not enabled by default.

Inventory (CMake targets and external deps)
- Primary targets (from CMake/CLion):
  - MilkDAWp (JUCE plugin target; VST3; optional Standalone via MILKDAWP_BUILD_STANDALONE)
  - MilkDAWp_VST3 (generated by JUCE tooling)
  - juce_vst3_helper (executable from JUCE tools)
  - MilkDAWp_tests (JUCE-based test runner)
  - CTest/CTK driver targets (Continuous/Nightly/Experimental etc.)
- External dependencies:
  - JUCE: fetched from ${JUCE_GIT_REPOSITORY} (default https://github.com/juce-framework/JUCE.git) at tag 7.0.12
  - projectM: optional; fetched from ${PROJECTM_GIT_REPOSITORY} (default https://github.com/projectM-visualizer/projectm.git) at tag v3.1.12 when MILKDAWP_WITH_PROJECTM=ON

Static-linking-specific flags or assumptions
- Windows MSVC runtime preference currently favors static linkage:
  - Option: MILKDAWP_PREFER_STATIC_RUNTIME_MSVC (default ON)
  - Behavior: Rewrites /MD and /MDd to /MT and /MTd across C/CXX flags
  - Implication: Conflicts with Phase 2+ requirement to build against dynamic runtime (/MD) and to dynamically link projectM.
- projectM link type is not forced; when enabled, linkage target auto-detected (projectM::projectM or projectM). No validation of SHARED vs STATIC.

Toolchain requirements verification
- cmake_minimum_required(VERSION 3.20) — below required >= 3.22 per roadmap/requirements.
- Compiler runtime setting on Windows: Currently biased to /MT; roadmap requirement is /MD.

Gaps vs. DEPENDENCY_REQUIREMENTS.md and roadmapped deltas
- Raise CMake minimum to >= 3.22.
- Default to dynamic MSVC runtime (/MD) and remove /MT preference path; treat static runtime as unsupported.
- Introduce submodules for JUCE and projectM under extern/ and pin to known-good versions (Phase 1).
- Integrate projectM as SHARED and enforce presence at configure time when enabled; prefer building from source under extern/ (Phase 2).
- Add configure-time FATAL_ERROR if projectM target is missing or not SHARED (Phase 2).
- Add platform packaging steps to bundle projectM next to the plugin with rpaths/loader-paths as applicable (Phase 3).
- Add bootstrap scripts per requirements (Phase 4).
- Add LICENSES/ and THIRD_PARTY_NOTICES.md with correct texts (Phase 5).

Immediate artifacts created in Phase 0
- docs/audit-deps.md (this file)
- LICENSES/ placeholder directory
- THIRD_PARTY_NOTICES.md placeholder

Notes
- No functional changes performed in Phase 0 to avoid destabilizing current builds; future phases will incrementally refactor per roadmap.
